(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/relation/relation"],{"0b4d":function(e,t,o){"use strict";o.r(t);var n=o("c203"),a=o("3054");for(var r in a)"default"!==r&&function(e){o.d(t,e,function(){return a[e]})}(r);o("fcd8");var i=o("2877"),s=Object(i["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=s.exports},3054:function(e,t,o){"use strict";o.r(t);var n=o("c99c"),a=o.n(n);for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);t["default"]=a.a},c203:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},a=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return a})},c99c:function(e,t,o){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(){return o.e("components/mix-tree/mix-tree").then(o.bind(null,"b586"))},r=function(){return o.e("components/scodeError").then(o.bind(null,"94bf"))},i={data:function(){return{deliverGoods:!1,text:"扫码错误",showError:!1,outCode:"",chlidCodeArr:[],type:"",alonecode:"",list:[],flag:!0,firstData:[],count:0,flagClass:"",activity:""}},components:{error:r,mixTree:a},onLoad:function(){var e=plus.android.runtimeMainActivity();this.activity=e;plus.android.importClass("android.content.Context");var t=plus.android.implements("io.dcloud.feature.internal.reflect.BroadcastReceiver",{onReceive:r});this.flagClass=t;var o=plus.android.importClass("android.content.IntentFilter"),n=(plus.android.importClass("android.content.Intent"),new o);n.addAction("android.intent.ACTION_DECODE_DATA"),e.registerReceiver(t,n);var a=this;function r(e,t){plus.android.importClass(t);var o=t.getByteArrayExtra("barcode"),n=i(o),r=(t.getIntExtra("length",0),t.getByteExtra("barcodeType",0));i(r);if(n&&n.indexOf(a.$common.host_name)>-1){var s=n.split(a.$common.host_name)[1];a.outCode?a.getCodeZsNumberInside(s):a.getCodeZsNumber(s)}else a.showError=!0,a.outCode?(a.text="子码获取失败",a.type="relation"):(a.text="外码获取失败",a.type="createdClick")}function i(e){if("string"===typeof e)return e;for(var t="",o=e,n=0;n<o.length;n++){var a=o[n].toString(2),r=a.match(/^1+?(?=0)/);if(r&&8==a.length){for(var i=r[0].length,s=o[n].toString(2).slice(7-i),d=1;d<i;d++)s+=o[d+n].toString(2).slice(2);t+=String.fromCharCode(parseInt(s,2)),n+=i-1}else t+=String.fromCharCode(o[n])}return t}},destroyed:function(){this.activity.unregisterReceiver(this.flagClass)},onHide:function(){this.activity.unregisterReceiver(this.flagClass)},onUnload:function(){this.activity.unregisterReceiver(this.flagClass)},methods:{treeItemClick:function(e){},getCodeZsNumber:function(e){var t=this;this.$common.get("/trace-api/trace/getSubCodeById?sid="+e).then(function(e){200===Number(e.data.code)?(Number(e.data.data.isEnable)>0?t.deliverGoods=!1:t.deliverGoods=!0,"N"===e.data.data.isLeaf?(t.$common.showToast("扫码成功","success"),t.showError=!1,t.outCode=e.data.data.traceSubCodeNumber||"",t.getTree()):(t.showError=!0,t.text="此码不是外码,外码获取失败",t.type="createdClick")):t.$common.showToast(e.data.message,"none")})},getCodeZsNumberInside:function(t,o,n){var a=this;this.$common.get("/trace-api/trace/getSubCodeById?sid="+t).then(function(t){if(a.count=0,200===Number(t.data.code))if(a.chlidCodeArr.indexOf(t.data.data.traceSubCodeNumber)>-1)a.$common.showToast("编码已存在","none");else if(t.data.data.traceSubCodeNumber===a.outCode)a.$common.showToast("不能关联本身","none");else{if(a.iterator(a.list,t.data.data.traceSubCodeNumber),console.log(e("this.count ",a.count," at pages\\relation\\relation.vue:206")),a.count>0)return a.$common.showToast("编码已存在","none"),setTimeout(function(){a.getTree()},800),!1;a.chlidCodeArr.push(t.data.data.traceSubCodeNumber),a.getTree()}else that.$common.showToast(t.data.message,"none")})},createdClick:function(){var e=this;n.scanCode({success:function(t){var o=e;if(t.result&&t.result.indexOf(o.$common.host_name)>-1){var n=t.result.split(o.$common.host_name)[1];e.$common.get("/trace-api/trace/getSubCodeById?sid="+n).then(function(t){200===Number(t.data.code)?(Number(t.data.data.isEnable)>0?e.deliverGoods=!1:e.deliverGoods=!0,"N"===t.data.data.isLeaf?(o.$common.showToast("扫码成功","success"),o.showError=!1,o.outCode=t.data.data.traceSubCodeNumber||"",e.getTree()):(e.showError=!0,e.text="此码不是外码,外码获取失败",e.type="createdClick")):o.$common.showToast(t.data.message,"none")})}else e.showError=!0,e.text="外获取失败",e.type="createdClick"}})},confirm:function(){if(this.outCode)if(0!==this.chlidCodeArr.length||0!==this.list.length){var t={outCode:this.outCode,subCodeList:this.chlidCodeArr};this.$common.post("/trace-api/trace/relationOutCode",t).then(function(t){console.log(e("relationOutCode",t," at pages\\relation\\relation.vue:277")),200===Number(t.data.code)?(n.showToast({title:t.data.message,duration:2e3}),setTimeout(function(){n.navigateBack({delta:1})},1500)):n.showToast({title:t.data.message,duration:2e3,icon:"none"})})}else this.$common.showToast("子码不能为空","none");else this.$common.showToast("外码不能为空","none")},deleteCode:function(t){var o=this;console.log(e(t," at pages\\relation\\relation.vue:299")),n.showModal({title:"提示",content:"此操作将删除此子码编号",success:function(e){e.confirm&&o.$common.post("/trace-api/trace/deleteCode/"+t.id).then(function(e){if(200===Number(e.data.code)){if(o.$common.showToast("删除成功","success"),o.chlidCodeArr.indexOf(String(t.name))>-1){var n=0;for(var a in o.chlidCodeArr)if(String(o.chlidCodeArr[a])===String(t.name)){n=a;break}var r=o.chlidCodeArr;r.splice(n,1)}o.getTree()}else o.$common.showToast(e.data.message,"none")})}})},iterator:function(e,t){for(var o in e)String(e[o].traceSubCodeNumber)===String(t)&&this.count++,null!==e[o].children&&(e[o].children=this.iterator(e[o].children,t))},relation:function(){var e=this;n.scanCode({success:function(t){var o=e;if(t.result&&t.result.indexOf(o.$common.host_name)>-1){var n=t.result.split(o.$common.host_name)[1];e.$common.get("/trace-api/trace/getSubCodeById?sid="+n).then(function(t){if(e.count=0,200===Number(t.data.code))if(e.chlidCodeArr.indexOf(t.data.data.traceSubCodeNumber)>-1)e.$common.showToast("编码已存在","none");else if(t.data.data.traceSubCodeNumber===e.outCode)e.$common.showToast("不能关联本身","none");else{if(e.iterator(e.list,t.data.data.traceSubCodeNumber),e.count>0)return e.$common.showToast("编码已存在","none"),setTimeout(function(){e.getTree()},800),!1;e.chlidCodeArr.push(t.data.data.traceSubCodeNumber),e.getTree()}else o.$common.showToast(t.data.message,"none")})}else e.showError=!0,e.text="子码获取失败",e.type="relation"}})},getTree:function(){var e=this;this.$common.post("/trace-api/trace/getTreeListCode",{subCodeList:this.chlidCodeArr,outCode:this.outCode}).then(function(t){e.list=t.data.data})}}};t.default=i}).call(this,o("0de9")["default"],o("6e42")["default"])},d638:function(e,t,o){"use strict";(function(e){o("7b83"),o("921b");n(o("66fd"));var t=n(o("0b4d"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])},fc7f:function(e,t,o){},fcd8:function(e,t,o){"use strict";var n=o("fc7f"),a=o.n(n);a.a}},[["d638","common/runtime","common/vendor"]]]);